<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Ennui: A MUD engine in 100% Rust, running here as a WebAssembly module</title>
  </head>
  <body style="background-color: black; color: white">
    <script src="/socket.io/socket.io.js"></script>
  <div id="result" style="padding-left:1em;margin-bottom: 1em;white-space:pre;background-color: black;height:30em;color: white">

  </div>
  <form id='form' autocomplete="off" onsubmit=fd >
    > <input type="text" id="command" name="command" placeholder="enter thy wish. it shall be my command" autofocus style="background-color: black;
    color: darkgrey;
    border-width: 1px;
    width: 75%;
    height: 2em;
    border-style: solid;
    margin-top: 1em;
    padding-left: 2em;
    font-size: large;
}" autocomplete="off"><br>
  </form>
    <script type="text/javascript">
        var socket = io();

        var form = document.getElementById('form');
        var input = document.getElementById('command');

        var id = -1;

        function fd(event) {
          event.preventDefault();
          if (input.value) {
            socket.emit('chat message', input.value);
            input.value = '';
          }
        }

        form.addEventListener('submit', fd);

        function processOutput(current, rawOutput) {
          let currentArray = current.split("\n");
          let outputArray = rawOutput.split("\n");
          let totalOutput = currentArray.concat(outputArray);
          const maxLines = 25;

          if (totalOutput.length > maxLines) {
            totalOutput = totalOutput.slice(totalOutput.length - maxLines, totalOutput.length);
          }

          let coloredOutput = totalOutput.join("\n");
          return coloredOutput
        }
        
        socket.on('chat message', (msg) => {
            console.log('HERE');
            let current = document.getElementById("result").innerHTML;
            let rawOutput = msg;
            let coloredOutput = processOutput(current, rawOutput);

            document.getElementById("result").innerHTML = coloredOutput;
        });

        socket.on('id', (pid) => {
            console.log("GOT IT");
            id = pid;
            console.log(id);
        }); 

    </script>
  </body>
</html>
